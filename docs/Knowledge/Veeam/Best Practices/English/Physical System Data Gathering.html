<!DOCTYPE html><html><head><title>Codedoc</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/codedoc/docs/images/KostweinLogo.ico"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Roboto', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/codedoc/docs/assets/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/codedoc/docs/assets/codedoc-bundle.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"></head><body data-path="docs\Knowledge\Veeam\Best Practices\English\Physical System Data Gathering.md"><div class="header-0-0-6"><script async="" defer="" src="https://buttons.github.io/buttons.js"></script><a class="github-button" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="false" data-show-count="true" data-size="false" href="https://github.com/In-Pro-Org/codedoc/">Star</a><br><br><a class="watermark-0-0-5" href="https://github.com/CONNECT-platform/codedoc" target="_blank">Created With<svg viewBox="0 0 536 296" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="codedoc" transform="translate(-244.000000, -364.000000)" fill-rule="nonzero"><path d="M580,532 C615.346224,532 644,560.653776 644,596 C644,631.346224 615.346224,660 580,660 C544.653776,660 516,631.346224 516,596 C516,560.653776 544.653776,532 580,532 Z M716,532 C751.346224,532 780,560.653776 780,596 C780,631.346224 751.346224,660 716,660 L692,660 C687.581722,660 684,656.418278 684,652 C684,647.581722 687.581722,644 692,644 L716,644 C742.509668,644 764,622.509668 764,596 C764,569.490332 742.509668,548 716,548 L692,548 C687.581722,548 684,544.418278 684,540 C684,535.581722 687.581722,532 692,532 L716,532 Z M468,532 C472.418278,532 476,535.581722 476,540 L476,652 C476,656.418278 472.418278,660 468,660 L444,660 C408.653776,660 380,631.346224 380,596 C380,560.653776 408.653776,532 444,532 L468,532 Z M332,532 C336.418278,532 340,535.581722 340,540 L340,652 C340,656.418278 336.418278,660 332,660 L252,660 C247.581722,660 244,656.418278 244,652 L244,540 C244,535.581722 247.581722,532 252,532 L332,532 Z M580,548 C553.490332,548 532,569.490332 532,596 C532,622.509668 553.490332,644 580,644 C606.509668,644 628,622.509668 628,596 C628,569.490332 606.509668,548 580,548 Z M461,548 L444,548 C417.490332,548 396,569.490332 396,596 C396,622.509668 417.490332,644 444,644 L461,644 L461,548 Z M444,364 C479.346224,364 508,392.653776 508,428 C508,463.346224 479.346224,492 444,492 C408.653776,492 380,463.346224 380,428 C380,392.653776 408.653776,364 444,364 Z M332,364 C336.418278,364 340,367.581722 340,372 C340,376.418278 336.418278,380 332,380 L308,380 C281.490332,380 260,401.490332 260,428 C260,454.509668 281.490332,476 308,476 L332,476 C336.418278,476 340,479.581722 340,484 C340,488.418278 336.418278,492 332,492 L308,492 C272.653776,492 244,463.346224 244,428 C244,392.653776 272.653776,364 308,364 L332,364 Z M580,364 C615.346224,364 644,392.653776 644,428 C644,463.346224 615.346224,492 580,492 L556,492 C551.581722,492 548,488.418278 548,484 L548,372 C548,367.581722 551.581722,364 556,364 L580,364 Z M772,364 C776.418278,364 780,367.581722 780,372 C780,376.418278 776.418278,380 772,380 L700,380 L700,420 L772,420 C776.418278,420 780,423.581722 780,428 C780,432.418278 776.418278,436 772,436 L700,436 L700,476 L772,476 C776.418278,476 780,479.581722 780,484 C780,488.418278 776.418278,492 772,492 L692,492 C687.581722,492 684,488.418278 684,484 L684,372 C684,367.581722 687.581722,364 692,364 L772,364 Z M444,380 C417.490332,380 396,401.490332 396,428 C396,454.509668 417.490332,476 444,476 C470.509668,476 492,454.509668 492,428 C492,401.490332 470.509668,380 444,380 Z M580,380 L563,380 L563,476 L580,476 C606.509668,476 628,454.509668 628,428 C628,401.490332 606.509668,380 580,380 Z"></path></g></svg></a></div><div id="-codedoc-container" class="container"><hr><p>created: 2024-08-01T12:52:45 (UTC +02:00)
tags: []
source: <a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html">https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html</a>
author: </p><hr><h1 id="physical-system-data-gathering--veeam-backup--replication-best-practice-guide" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Physical System Data Gathering | Veeam Backup &amp; Replication Best Practice Guide</h1><hr><h2 id="introduction" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#introduction"></a>Introduction</h2><p>One of the more challenging aspects when it comes to sizing a Veeam Backup and Recovery solution is gathering physical host information. Unlike with VMware where it is relatively easy to use well-known tools such as RvTools to pull relevant information out of the environment, physical environments do not have the convenience of a single free tool that allows you to gather this information.</p><p>In this guide, we will walk you through methods of gathering infrastructure information with native tools that you likely already have access to. However, if you have any other method of capturing this data such as an inventory tool we recommend using that instead.</p><h3 id="prerequisites" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#prerequisites"></a>Prerequisites</h3><p>Windows:</p><ul><li>WinRM enabled on all hosts to be assessed</li><li>WinRM ports 5985 and 5986 open on target servers</li></ul><p>Linux:</p><ul><li>SSH enabled on each server to be assessed</li><li>SSH key included in the trusted hosts file if an SSH key is required</li></ul><h2 id="windows" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#windows"></a>Windows</h2><h3 id="setting-up-assessment-server" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#setting-up-assessment-server"></a>Setting up Assessment server</h3><p>Before moving forward with this guide, the following must be installed on the assessment server. Install Remote Administration Tools and Active Directory module for Windows PowerShell.</p><p>Windows Server:</p><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/Enable_RSAT.png" alt="RSAT_Windows"></p><p>Windows 10:</p><p>WIN+I (Windows Settings) Apps &gt; Optional Feature &gt; RSAT: Active Directory Domain Services and Lightweight Directory Services</p><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/Enable_RSAT_Win10.png" alt="RSAT_Windows"></p><p>These can also be installed via PowerShell:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Add-WindowsCapability -online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0" id="code1-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Add-WindowsCapability -online -Name Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0</div><br></code></pre><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/RSAT_Enable_PoSh.png" alt="Enable_RSAT_PoSH"></p><p>In either case, you will also need to install the PowerShell Active Directory Module which can be done via PowerShell:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Install-WindowsFeature RSAT-AD-PowerShell" id="code2-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Install-WindowsFeature RSAT-AD-PowerShell</div><br></code></pre><p>Hopefully you have WinRM already enabled on the servers that will be assessed, otherwise you have to enable it. You can check if WinRM is enabled on the assessment server via this command:</p><p>You should see an output like this:</p><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/WSMan_PoSH.png" alt="Test-WSMan"></p><p>If you get back an error, then it is an indication that WinRM is not set up on your system. To set up the WinRM using quick config type the following:</p><p>You can check the WinRM server connection settings via:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="winrm get winrm/config/client" id="code3-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>winrm get winrm/config/client</div><br></code></pre><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/winrm_client_info.png" alt="WinRM_Client_Info"></p><p>This shows the configuration for WinRM.</p><p>For you to remote to all the systems you will need to add the hosts to the Trusted Hosts on the assessment server. This can be done individually though this is restrictive or via a wildcard <code>*</code>.</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Set-Item WSMan:\localhost\Client\TrustedHosts *" id="code4-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Set-Item WSMan:\localhost\Client\TrustedHosts *</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="Set-Item WSMan:\localhost\Client\TrustedHosts *.yourdomain.com" id="code4-l2"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Set-Item WSMan:\localhost\Client\TrustedHosts *.yourdomain.com</div><br></code></pre><p>The client configuration can be seen using this command:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Winrm get winrm/config/client" id="code5-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Winrm get winrm/config/client</div><br></code></pre><p>Note that for this guide ‘Negotiate’ will be used for authentication, the server will determine whether to use Kerberos or NTLM. Both options use encrypted messaging over HTTP. Kerberos is more secure and is the default protocol used in a Domain environment. CredSSP is also an option but out-of-scope for this document.</p><h3 id="https" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#https"></a>HTTPS</h3><p>As stated above all protocols apart from Basic use message-level encryption over a standard HTTP connection. If you wish to run WinRM over HTTPS then a certificate is required on each of the hosts that will used with WinRM.</p><p>Fortunately, Ansible uses WinRM for remote management, and has a handy PowerShell script to make this process easier.</p><p><a href="https://docs.ansible.com/ansible/2.5/user_guide/windows_setup.html#setup-winrm-listener">Ansible docs</a></p><p><a href="https://github.com/ansible/ansible/blob/devel/examples/scripts/ConfigureRemotingForAnsible.ps1">ConfigRemotingForAnsible.ps1</a></p><p>This creates a self-signed certificate and creates the listener with the certificate. It also opens the required firewall ports.</p><p>There are also steps that are required on the assessment server, please see the <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-client/system-management-components/configure-winrm-for-https">Microsoft Documentation</a></p><h2 id="setting-up-winrm-using-group-policy" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#setting-up-winrm-using-group-policy"></a>Setting up WinRM using Group Policy</h2><p>You are able to enable WinRM using Group Policy via the following steps:</p><p>Add a new GPO and then in the editor:</p><ul><li>Go to Computer Configuration &gt; Policies &gt; Administrative Templates &gt; Windows Components &gt; Windows Remote Management (WinRM) &gt; WinRM Service</li><li>Right-Click “Allow remote server management through WinRM”</li><li>Enable and add “*” to the IP filers or add a specific IP address if required.</li></ul><p>Next enable the service:</p><ul><li>Go to Computer Configuration &gt; Policies &gt; Preferences &gt; Control Panel Settings</li><li>Right-Click Services &gt; New &gt; Services</li><li>Choose Automatic (Delayed Start)</li><li>Services Name: WinRM</li><li>Service Action: Start Service</li></ul><p>Enable firewall rule:</p><ul><li>Go to Computer Configuration &gt; Policies &gt; Security Settings &gt; Windows Firewall with Advanced Security.</li><li>Right-click Inbound Rules and start a New Rule…</li><li>Select Predefined: Windows Remote Management &gt; Next</li><li>Select Domain and Private, and Allow the connection</li></ul><p>Private can be removed by editing the rule and deselecting the Private option.</p><h2 id="gathering-hostnames" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#gathering-hostnames"></a>Gathering Hostnames</h2><p>To test connections and then to pull down the relevant information you will need first to gather all the in-scope hostnames.</p><p>Hostnames can be easily gathered by interrogating AD and exporting the names to a text file.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Get-ADComputer -filter \* | Select -Expand Name | Sort | sc \&quot;\$home\Desktop\AD2.txt\&quot;" id="code6-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Get-ADComputer -filter \* | Select -Expand Name | Sort | sc \"\$home\Desktop\AD2.txt\"</div><br></code></pre><p>Note that this does tend to include old AD entries so it is recommended to go through and remove any before proceeding as they may show as false failures later down the line.</p><p>If you don’t have access to AD or need to assess non-AD joined servers, you can build a list of IP addresses using the following:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="$ping = New-Object System.Net.Networkinformation.Ping" id="code7-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$ping = New-Object System.Net.Networkinformation.Ping</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="1..10 | % {\$ping.send\(\&quot;192.168.1.\$\_\&quot;) } | Where-Object Status -eq \&quot;Success\&quot; | Select-Object -Property \&quot;Address\&quot; | Select -Expand Address | Out-File -FilePath \&quot;\$home\Desktop\IPaddresses2.txt\&quot;" id="code7-l2"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>1..10 | % {\$ping.send\(\"192.168.1.\$\_\") } | Where-Object Status -eq \"Success\" | Select-Object -Property \"Address\" | Select -Expand Address | Out-File -FilePath \"\$home\Desktop\IPaddresses2.txt\"</div><br></code></pre><p>Change the 1..10 to the network range you wish to check as well as updating the rest of the IP address.</p><p>Note that all target servers need to answer on ICMP pings for this to work.</p><h2 id="testing-the-connections" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#testing-the-connections"></a>Testing the connections</h2><p>Before moving forward with running the command to get the disk information we recommend that you first test the connections, this can be done using the following.</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="$credentials = Get-Credential" id="code8-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$credentials = Get-Credential</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code8-l2"><span class="lineCounter-0-0-13 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="Test-WSMan WIN-AD-DNS -Authentication Negotiate -Credential $credential" id="code8-l3"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Test-WSMan WIN-AD-DNS -Authentication Negotiate -Credential $credential</div><br></code></pre><p>Next, to test all the servers in the host file you can use the following</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="$devices = Get-Content “$home\Desktop\AD2.txt”" id="code9-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$devices = Get-Content “$home\Desktop\AD2.txt”</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="$creds = Get-Credentials" id="code9-l2"><span class="lineCounter-0-0-13 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$creds = Get-Credentials</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="\$devices | ForEach-Object {" id="code9-l3"><span class="lineCounter-0-0-13 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>\$devices | ForEach-Object {</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    try {" id="code9-l4"><span class="lineCounter-0-0-13 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    try {</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        Write-Host &quot;Running on $_&quot;" id="code9-l5"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        Write-Host "Running on $_"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        Test-WSMan $_ -Authentication Negotiate -Credential $creds -ErrorAction Stop" id="code9-l6"><span class="lineCounter-0-0-13 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        Test-WSMan $_ -Authentication Negotiate -Credential $creds -ErrorAction Stop</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    }" id="code9-l7"><span class="lineCounter-0-0-13 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    }</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    catch {" id="code9-l8"><span class="lineCounter-0-0-13 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    catch {</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        Write-Host &quot;Failed&quot;" id="code9-l9"><span class="lineCounter-0-0-13 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        Write-Host "Failed"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        Write-Host &quot;&quot;" id="code9-l10"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        Write-Host ""</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    }" id="code9-l11"><span class="lineCounter-0-0-13 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    }</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="}" id="code9-l12"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>}</div><br></code></pre><p>Note the systems that cannot be connected (displays ‘failed’); these will need to be checked to see if they have connectivity, are still present in the environment or do not have the winrm server service running.</p><h2 id="starting-the-sessions-and-getting-the-data" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#starting-the-sessions-and-getting-the-data"></a>Starting the Sessions and getting the data</h2><p>In this section, we will start sessions to all the servers that are in the hosts file then run a command that will pull the relevant data from each host.</p><p>To establish the initial connection, the following needs to be run.</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="$servers = Get-Content -Path “$home\Desktop\AD2.txt”" id="code10-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$servers = Get-Content -Path “$home\Desktop\AD2.txt”</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="$multisession = New-PSSession -ComputerName $servers -Credential $creds -Authentication Negotiate" id="code10-l2"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>$multisession = New-PSSession -ComputerName $servers -Credential $creds -Authentication Negotiate</div><br></code></pre><p>Note that the standard limit is 50, but this can be modified using the -ThrottleLimit flag.</p><p>Running sessions can be seen by simply entering:</p><p>Next, we are going to run the Get-PSDrive command on each server to get the Disk Utilisation information and export it to a CSV.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Invoke-Command -Session $multisession -ScriptBlock{Get-PSDrive -PSProvider FileSystem} |Select-Object -Property  Used, Free, PSComputerName, Name, Description | Export-Csv -Path &quot;$home\Desktop\DiskInfo.csv&quot;" id="code11-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Invoke-Command -Session $multisession -ScriptBlock{Get-PSDrive -PSProvider FileSystem} |Select-Object -Property  Used, Free, PSComputerName, Name, Description | Export-Csv -Path "$home\Desktop\DiskInfo.csv"</div><br></code></pre><p>Once finished ensure the connections have been closed by running:</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Get-PSSession | Remove-PSSession" id="code12-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Get-PSSession | Remove-PSSession</div><br></code></pre><p>If this all worked correctly, you should now have a CSV file with all the server information. The open sessions to the Servers can be terminated by simply closing the PowerShell session.</p><h3 id="output" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#output"></a>Output</h3><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/Windows_output.png" alt="Windows_Output"></p><h2 id="linux" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#linux"></a>Linux</h2><p>Before we start, it is required that all the Linux Servers to be assessed have SSH enabled either with a password, or an SSH key.</p><p>There are many ways to connect to multiple Linux machines to run; however, we have found the easiest method is to use Python. Ensure to include Python in your environmental Path (check box on install startup).</p><p>Before you start, you will need to download <a href="https://www.python.org/">Python</a> to the server that will be running the inventory.</p><p>Python will automatically install PIP to your machine, which makes it simple to import Python packages. The packages we will require for this automation Paramiko which adds SSH capabilities and XlsxWriter which can write out to excel.</p><p>In CMD type:</p><p>Also, XlsxWriter, this will allow the output to be saved to an Excel file.</p><p>Using the same method as in the Windows section above to gather the IP address for all the Linux servers, you can now iterate over these using Paramiko.</p><p>Create a python file, using <a href="https://code.visualstudio.com/">VS code</a> is recommended and input the following:</p><p>Without SSH key:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="import paramiko" id="code13-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import paramiko</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="import xlsxwriter" id="code13-l2"><span class="lineCounter-0-0-13 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import xlsxwriter</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="import logging" id="code13-l3"><span class="lineCounter-0-0-13 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import logging</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="from pathlib import Path" id="code13-l4"><span class="lineCounter-0-0-13 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>from pathlib import Path</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l5"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="# sets up error logging to a file" id="code13-l6"><span class="lineCounter-0-0-13 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span># sets up error logging to a file</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="logging.basicConfig(filename=&quot;.\\issues.log&quot;)" id="code13-l7"><span class="lineCounter-0-0-13 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>logging.basicConfig(filename=".\\issues.log")</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="logger = logger.getLogger()" id="code13-l8"><span class="lineCounter-0-0-13 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>logger = logger.getLogger()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l9"><span class="lineCounter-0-0-13 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="username = &quot;username&quot; # Updated these fields with your info" id="code13-l10"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>username = "username" # Updated these fields with your info</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="password = &quot;password&quot;" id="code13-l11"><span class="lineCounter-0-0-13 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>password = "password"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l12"><span class="lineCounter-0-0-13 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="# Python will look for the IP address file" id="code13-l13"><span class="lineCounter-0-0-13 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span># Python will look for the IP address file</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="try:" id="code13-l14"><span class="lineCounter-0-0-13 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>try:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    path = Path('C:/Users/Administrator/Desktop/IPAddress.txt')  # change IP Address file location" id="code13-l15"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    path = Path('C:/Users/Administrator/Desktop/IPAddress.txt')  # change IP Address file location</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="except FileNotFoundError:" id="code13-l16"><span class="lineCounter-0-0-13 -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>except FileNotFoundError:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Issue with file imports')" id="code13-l17"><span class="lineCounter-0-0-13 -codedoc-line-counter">17<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Issue with file imports')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l18"><span class="lineCounter-0-0-13 -codedoc-line-counter">18<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="pathToExecl = Path('C:/Users/Administrator/Desktop/diskData.xlsx') # change output location" id="code13-l19"><span class="lineCounter-0-0-13 -codedoc-line-counter">19<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>pathToExecl = Path('C:/Users/Administrator/Desktop/diskData.xlsx') # change output location</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="ipAdd = []" id="code13-l20"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">20<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>ipAdd = []</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="diskData = []" id="code13-l21"><span class="lineCounter-0-0-13 -codedoc-line-counter">21<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>diskData = []</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l22"><span class="lineCounter-0-0-13 -codedoc-line-counter">22<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="&quot;&quot;&quot; Python will loop over all addresses in text file &quot;&quot;&quot;" id="code13-l23"><span class="lineCounter-0-0-13 -codedoc-line-counter">23<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>""" Python will loop over all addresses in text file """</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="with open(path, 'r') as f:" id="code13-l24"><span class="lineCounter-0-0-13 -codedoc-line-counter">24<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>with open(path, 'r') as f:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for ip in f:" id="code13-l25"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">25<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for ip in f:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ip = ip.rstrip()" id="code13-l26"><span class="lineCounter-0-0-13 -codedoc-line-counter">26<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ip = ip.rstrip()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ssh = paramiko.SSHClient()" id="code13-l27"><span class="lineCounter-0-0-13 -codedoc-line-counter">27<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ssh = paramiko.SSHClient()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())" id="code13-l28"><span class="lineCounter-0-0-13 -codedoc-line-counter">28<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        try:" id="code13-l29"><span class="lineCounter-0-0-13 -codedoc-line-counter">29<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        try:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            # ssh connection" id="code13-l30"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">30<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            # ssh connection</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            ssh.connect(hostname=ip, username=username, password=password)" id="code13-l31"><span class="lineCounter-0-0-13 -codedoc-line-counter">31<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            ssh.connect(hostname=ip, username=username, password=password)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        except Exception as e:" id="code13-l32"><span class="lineCounter-0-0-13 -codedoc-line-counter">32<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        except Exception as e:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            # log errror to log file" id="code13-l33"><span class="lineCounter-0-0-13 -codedoc-line-counter">33<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            # log errror to log file</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            logger.error(e)" id="code13-l34"><span class="lineCounter-0-0-13 -codedoc-line-counter">34<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            logger.error(e)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Error connecting to server ' + ip)" id="code13-l35"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">35<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Error connecting to server ' + ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Check error log for details')" id="code13-l36"><span class="lineCounter-0-0-13 -codedoc-line-counter">36<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Check error log for details')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        else:" id="code13-l37"><span class="lineCounter-0-0-13 -codedoc-line-counter">37<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        else:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            # Python runs 'df' command" id="code13-l38"><span class="lineCounter-0-0-13 -codedoc-line-counter">38<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            # Python runs 'df' command</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            cmd=&quot;df&quot;" id="code13-l39"><span class="lineCounter-0-0-13 -codedoc-line-counter">39<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            cmd="df"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            # Catching the response" id="code13-l40"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">40<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            # Catching the response</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            stdin, stdout, stderr = ssh.exec_command(cmd)" id="code13-l41"><span class="lineCounter-0-0-13 -codedoc-line-counter">41<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            stdin, stdout, stderr = ssh.exec_command(cmd)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            stdout=stdout.readlines()" id="code13-l42"><span class="lineCounter-0-0-13 -codedoc-line-counter">42<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            stdout=stdout.readlines()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            # Output to a Python list" id="code13-l43"><span class="lineCounter-0-0-13 -codedoc-line-counter">43<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            # Output to a Python list</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            for item in stdout:" id="code13-l44"><span class="lineCounter-0-0-13 -codedoc-line-counter">44<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            for item in stdout:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                ipAdd.append(ip)" id="code13-l45"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">45<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                ipAdd.append(ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                item = item.rstrip()" id="code13-l46"><span class="lineCounter-0-0-13 -codedoc-line-counter">46<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                item = item.rstrip()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                diskData.append(item)" id="code13-l47"><span class="lineCounter-0-0-13 -codedoc-line-counter">47<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                diskData.append(item)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Data collected for ' + ip)" id="code13-l48"><span class="lineCounter-0-0-13 -codedoc-line-counter">48<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Data collected for ' + ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code13-l49"><span class="lineCounter-0-0-13 -codedoc-line-counter">49<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="&quot;&quot;&quot;Python export to Excel&quot;&quot;&quot;" id="code13-l50"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">50<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>"""Python export to Excel"""</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="if len(diskData) &amp;gt; 0:" id="code13-l51"><span class="lineCounter-0-0-13 -codedoc-line-counter">51<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>if len(diskData) &gt; 0:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Writing to excel')" id="code13-l52"><span class="lineCounter-0-0-13 -codedoc-line-counter">52<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Writing to excel')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    # Creates workbook" id="code13-l53"><span class="lineCounter-0-0-13 -codedoc-line-counter">53<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    # Creates workbook</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    workbook = xlsxwriter.Workbook(pathToExecl)" id="code13-l54"><span class="lineCounter-0-0-13 -codedoc-line-counter">54<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    workbook = xlsxwriter.Workbook(pathToExecl)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    # Creates worksheet" id="code13-l55"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">55<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    # Creates worksheet</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    worksheet = workbook.add_worksheet()" id="code13-l56"><span class="lineCounter-0-0-13 -codedoc-line-counter">56<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    worksheet = workbook.add_worksheet()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    # Loop through all lines in the 'ipAdd' list" id="code13-l57"><span class="lineCounter-0-0-13 -codedoc-line-counter">57<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    # Loop through all lines in the 'ipAdd' list</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for row_num, data in enumerate(ipAdd):" id="code13-l58"><span class="lineCounter-0-0-13 -codedoc-line-counter">58<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for row_num, data in enumerate(ipAdd):</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        worksheet.write(row_num, 0, data)" id="code13-l59"><span class="lineCounter-0-0-13 -codedoc-line-counter">59<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        worksheet.write(row_num, 0, data)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="     # Loop through all lines in the 'diskData' list" id="code13-l60"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">60<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>     # Loop through all lines in the 'diskData' list</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for row_num, data in enumerate(diskData):" id="code13-l61"><span class="lineCounter-0-0-13 -codedoc-line-counter">61<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for row_num, data in enumerate(diskData):</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        worksheet.write(row_num, 1, data)" id="code13-l62"><span class="lineCounter-0-0-13 -codedoc-line-counter">62<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        worksheet.write(row_num, 1, data)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    # close workbook" id="code13-l63"><span class="lineCounter-0-0-13 -codedoc-line-counter">63<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    # close workbook</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    workbook.close()" id="code13-l64"><span class="lineCounter-0-0-13 -codedoc-line-counter">64<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    workbook.close()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Export finished')" id="code13-l65"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">65<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Export finished')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="else:" id="code13-l66"><span class="lineCounter-0-0-13 -codedoc-line-counter">66<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>else:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Data was not collected')" id="code13-l67"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">67<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Data was not collected')</div><br></code></pre><p>Paramiko will look in the .ssh folder and try any keys listed there before trying the password. However, if your SSH key is not in the .ssh folder, or if you need to specify a password then you will need to specify the location manually:</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="import paramiko" id="code14-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import paramiko</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="import logging" id="code14-l2"><span class="lineCounter-0-0-13 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import logging</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="import xlsxwriter" id="code14-l3"><span class="lineCounter-0-0-13 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>import xlsxwriter</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="from pathlib import Path" id="code14-l4"><span class="lineCounter-0-0-13 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>from pathlib import Path</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code14-l5"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="logging.basicConfig(filename=&quot;.\\issues.log&quot;)" id="code14-l6"><span class="lineCounter-0-0-13 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>logging.basicConfig(filename=".\\issues.log")</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="logger = logger.getLogger()" id="code14-l7"><span class="lineCounter-0-0-13 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>logger = logger.getLogger()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code14-l8"><span class="lineCounter-0-0-13 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="username = &quot;username&quot;" id="code14-l9"><span class="lineCounter-0-0-13 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>username = "username"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="password = &quot;password&quot; # only required if SSH key requires it" id="code14-l10"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>password = "password" # only required if SSH key requires it</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="try:" id="code14-l11"><span class="lineCounter-0-0-13 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>try:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    path = Path('C:/Users/Administrator/Desktop/IPAddress.txt') # change IP Address file location" id="code14-l12"><span class="lineCounter-0-0-13 -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    path = Path('C:/Users/Administrator/Desktop/IPAddress.txt') # change IP Address file location</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    keyPath = Path('C:/Users/Administrator/.ssh/id_rsa') # change ssh key location" id="code14-l13"><span class="lineCounter-0-0-13 -codedoc-line-counter">13<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    keyPath = Path('C:/Users/Administrator/.ssh/id_rsa') # change ssh key location</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="except FileNotFoundError:" id="code14-l14"><span class="lineCounter-0-0-13 -codedoc-line-counter">14<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>except FileNotFoundError:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Issue with file imports')" id="code14-l15"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">15<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Issue with file imports')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code14-l16"><span class="lineCounter-0-0-13 -codedoc-line-counter">16<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="key = paramiko.RSAKey.from_private_key_file(keyPath) # Comment out this and uncomment the below if a SSH password is in use" id="code14-l17"><span class="lineCounter-0-0-13 -codedoc-line-counter">17<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>key = paramiko.RSAKey.from_private_key_file(keyPath) # Comment out this and uncomment the below if a SSH password is in use</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="# key = paramiko.RSAKey.from_private_key_file(keyPath, password) " id="code14-l18"><span class="lineCounter-0-0-13 -codedoc-line-counter">18<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span># key = paramiko.RSAKey.from_private_key_file(keyPath, password) </div><br><div class="line-0-0-16  -codedoc-code-line" data-content="pathToExecl = Path('C:/Users/Administrator/Desktop/diskData.xlsx') # change excel output location" id="code14-l19"><span class="lineCounter-0-0-13 -codedoc-line-counter">19<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>pathToExecl = Path('C:/Users/Administrator/Desktop/diskData.xlsx') # change excel output location</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="ipAdd = []" id="code14-l20"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">20<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>ipAdd = []</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="diskData = []" id="code14-l21"><span class="lineCounter-0-0-13 -codedoc-line-counter">21<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>diskData = []</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code14-l22"><span class="lineCounter-0-0-13 -codedoc-line-counter">22<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="with open(path, 'r') as f:" id="code14-l23"><span class="lineCounter-0-0-13 -codedoc-line-counter">23<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>with open(path, 'r') as f:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for ip in f:" id="code14-l24"><span class="lineCounter-0-0-13 -codedoc-line-counter">24<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for ip in f:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ip = ip.rstrip()" id="code14-l25"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">25<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ip = ip.rstrip()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ssh = paramiko.SSHClient()" id="code14-l26"><span class="lineCounter-0-0-13 -codedoc-line-counter">26<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ssh = paramiko.SSHClient()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())" id="code14-l27"><span class="lineCounter-0-0-13 -codedoc-line-counter">27<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        try:" id="code14-l28"><span class="lineCounter-0-0-13 -codedoc-line-counter">28<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        try:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            ssh.connect(hostname=ip, username=username, pkey = key)" id="code14-l29"><span class="lineCounter-0-0-13 -codedoc-line-counter">29<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            ssh.connect(hostname=ip, username=username, pkey = key)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        except Exception as e:" id="code14-l30"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">30<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        except Exception as e:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            logger.error(e)" id="code14-l31"><span class="lineCounter-0-0-13 -codedoc-line-counter">31<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            logger.error(e)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Error connecting to server ' + ip)" id="code14-l32"><span class="lineCounter-0-0-13 -codedoc-line-counter">32<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Error connecting to server ' + ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Check error log for details')" id="code14-l33"><span class="lineCounter-0-0-13 -codedoc-line-counter">33<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Check error log for details')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        else:" id="code14-l34"><span class="lineCounter-0-0-13 -codedoc-line-counter">34<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        else:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            cmd=&quot;df&quot;" id="code14-l35"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">35<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            cmd="df"</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            stdin, stdout, stderr = ssh.exec_command(cmd)" id="code14-l36"><span class="lineCounter-0-0-13 -codedoc-line-counter">36<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            stdin, stdout, stderr = ssh.exec_command(cmd)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            stdout=stdout.readlines()" id="code14-l37"><span class="lineCounter-0-0-13 -codedoc-line-counter">37<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            stdout=stdout.readlines()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            for item in stdout:" id="code14-l38"><span class="lineCounter-0-0-13 -codedoc-line-counter">38<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            for item in stdout:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                ipAdd.append(ip)" id="code14-l39"><span class="lineCounter-0-0-13 -codedoc-line-counter">39<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                ipAdd.append(ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                item = item.rstrip()" id="code14-l40"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">40<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                item = item.rstrip()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="                diskData.append(item)" id="code14-l41"><span class="lineCounter-0-0-13 -codedoc-line-counter">41<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>                diskData.append(item)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="            print('Data collected for ' + ip)" id="code14-l42"><span class="lineCounter-0-0-13 -codedoc-line-counter">42<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>            print('Data collected for ' + ip)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="" id="code14-l43"><span class="lineCounter-0-0-13 -codedoc-line-counter">43<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-16  -codedoc-code-line" data-content="if len(diskData) &amp;gt; 0:" id="code14-l44"><span class="lineCounter-0-0-13 -codedoc-line-counter">44<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>if len(diskData) &gt; 0:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Writing to excel')" id="code14-l45"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">45<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Writing to excel')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    workbook = xlsxwriter.Workbook(pathToExecl)" id="code14-l46"><span class="lineCounter-0-0-13 -codedoc-line-counter">46<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    workbook = xlsxwriter.Workbook(pathToExecl)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    worksheet = workbook.add_worksheet()" id="code14-l47"><span class="lineCounter-0-0-13 -codedoc-line-counter">47<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    worksheet = workbook.add_worksheet()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for row_num, data in enumerate(ipAdd):" id="code14-l48"><span class="lineCounter-0-0-13 -codedoc-line-counter">48<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for row_num, data in enumerate(ipAdd):</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        worksheet.write(row_num, 0, data)" id="code14-l49"><span class="lineCounter-0-0-13 -codedoc-line-counter">49<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        worksheet.write(row_num, 0, data)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    for row_num, data in enumerate(diskData):" id="code14-l50"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">50<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    for row_num, data in enumerate(diskData):</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="        worksheet.write(row_num, 1, data)" id="code14-l51"><span class="lineCounter-0-0-13 -codedoc-line-counter">51<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>        worksheet.write(row_num, 1, data)</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    workbook.close()" id="code14-l52"><span class="lineCounter-0-0-13 -codedoc-line-counter">52<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    workbook.close()</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Export finished')" id="code14-l53"><span class="lineCounter-0-0-13 -codedoc-line-counter">53<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Export finished')</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="else:" id="code14-l54"><span class="lineCounter-0-0-13 -codedoc-line-counter">54<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>else:</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="    print('Data was not collected')" id="code14-l55"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">55<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    print('Data was not collected')</div><br></code></pre><p>Note: this code is provided without warranty, please check referenced resources before using. If you have any issues when running the code please check the log file that is created when you ran the code (<code>issues.log</code>).</p><p>The Python file can run directly in VSCode via the ‘play’ button in the top right or via PowerShell via:</p><h3 id="output-1" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#output-1"></a>Output</h3><p><img src="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Media/Linux_Output.png" alt="Linux_Output"></p><h2 id="setting-up-an-ssh-key" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#setting-up-an-ssh-key"></a>Setting up an SSH Key</h2><p>To set up your SSH key locally you will need OpenSSH, if you are using Windows 10 or WS2019 you can follow <a href="https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse">these installation steps</a>.</p><p>If you are on WS2016 or earlier you can install OpenSSH via Git Bash available from <a href="https://gitforwindows.org/">Git</a>.</p><p>With W10 &amp; W2019 run the following in PowerShell, on other systems run Git Bash.</p><pre class="with-bar"><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="ssh-keygen" id="code15-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>ssh-keygen</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="Generating public/private rsa key pair." id="code15-l2"><span class="lineCounter-0-0-13 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Generating public/private rsa key pair.</div><br><div class="line-0-0-16  -codedoc-code-line" data-content="Enter file in which to save the key (/your_home/.ssh/id_rsa):" id="code15-l3"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Enter file in which to save the key (/your_home/.ssh/id_rsa):</div><br></code></pre><p>Unless you wish to change the location click next.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="Enter passphrase (empty for no passphrase):" id="code16-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>Enter passphrase (empty for no passphrase):</div><br></code></pre><p>Enter a password if required, this will then create the keys.</p><p>If your Linux distribution supports</p><p>You will be able to easily copy the key to the system, this will require the target server to be accessible by a password.</p><pre class=""><code class="undefined -codedoc-code-snippet code-0-0-12" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16  -codedoc-code-line" data-content="ssh-copy-id -i ~/.ssh/mykey user@host" id="code17-l1"><span class="lineCounter-0-0-13 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>ssh-copy-id -i ~/.ssh/mykey user@host</div><br></code></pre><p>If not you will need to manually add the public key to the target host’s authorized keys file.</p><p>Once completed you will find the resulting Excel file will be in the location where you specified in the script.</p><h2 id="references" class="heading-0-0-1"><span class="anchor-0-0-2" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span><a href="https://bp.veeam.com/vbr/1_Assessment/A_Data_gathering/Physical_Systems_Gathering.html#references"></a>References</h2><ul><li><a href="https://docs.microsoft.com/en-us/windows/win32/winrm/installation-and-configuration-for-windows-remote-management">Set Up of WinRM</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/ssh-remoting-in-powershell-core?view=powershell-5.1">SSH Remoting with PowerShell</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssession?view=powershell-5.1">New-PSSession: PowerShell</a></li><li><a href="https://docs.microsoft.com/en-us/powershell/module/addsadministration/?view=win10-ps">Add AD Admin to Windows 10</a></li><li><a href="https://www.python.org/">Python</a></li><li><a href="http://www.paramiko.org/">Paramiko</a></li><li><a href="https://xlsxwriter.readthedocs.io/#">Xlsxwriter</a></li></ul><hr><div class="contentnav-0-0-11" data-no-search=""><a href="#physical-system-data-gathering--veeam-backup--replication-best-practice-guide" class="h1" data-content-highlight="physical-system-data-gathering--veeam-backup--replication-best-practice-guide">Physical System Data Gathering | Veeam Backup &amp; Replication Best Practice Guide</a><a href="#introduction" class="h2" data-content-highlight="introduction">Introduction</a><a href="#prerequisites" class="h3" data-content-highlight="prerequisites">Prerequisites</a><a href="#windows" class="h2" data-content-highlight="windows">Windows</a><a href="#setting-up-assessment-server" class="h3" data-content-highlight="setting-up-assessment-server">Setting up Assessment server</a><a href="#https" class="h3" data-content-highlight="https">HTTPS</a><a href="#setting-up-winrm-using-group-policy" class="h2" data-content-highlight="setting-up-winrm-using-group-policy">Setting up WinRM using Group Policy</a><a href="#gathering-hostnames" class="h2" data-content-highlight="gathering-hostnames">Gathering Hostnames</a><a href="#testing-the-connections" class="h2" data-content-highlight="testing-the-connections">Testing the connections</a><a href="#starting-the-sessions-and-getting-the-data" class="h2" data-content-highlight="starting-the-sessions-and-getting-the-data">Starting the Sessions and getting the data</a><a href="#output" class="h3" data-content-highlight="output">Output</a><a href="#linux" class="h2" data-content-highlight="linux">Linux</a><a href="#output-1" class="h3" data-content-highlight="output-1">Output</a><a href="#setting-up-an-ssh-key" class="h2" data-content-highlight="setting-up-an-ssh-key">Setting up an SSH Key</a><a href="#references" class="h2" data-content-highlight="references">References</a></div></div><div id="-codedoc-toc" class="toc-0-0-8"><div class="content-0-0-9"><div class="heading-0-0-3">Index</div><p><a href="/codedoc/">Home</a>
<a href="/codedoc/README">Index</a>
<a href="/codedoc/docs/Kostwein">Kostwein</a></p><div class="collapse-0-0-4 "><script id="GcrBoOgoZQ">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("GcrBoOgoZQ", "yAdNJkOJGbj52dvfV+HpdQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">PSModulesHelp</span><span class="icon-font closed">chevron_right</span></div><div class="content"><p><a href="/codedoc/docs/PSModulesHelp/ModuleDoku">PS Modules Help</a></p><hr></div></div><div class="collapse-0-0-4 "><script id="SAPJmqgXyc">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("SAPJmqgXyc", "yAdNJkOJGbj52dvfV+HpdQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">KnowledgeBase</span><span class="icon-font closed">chevron_right</span></div><div class="content"><blockquote><p><a href="/codedoc/docs/Knowledge/PowerShell/Index">PowerShell</a></p></blockquote></div></div><div class="collapse-0-0-4 "><script id="rfSiDyPGep">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("rfSiDyPGep", "yAdNJkOJGbj52dvfV+HpdQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">Links</span><span class="icon-font closed">chevron_right</span></div><div class="content"><blockquote><p><a href="/codedoc/docs/Links/LinksWiki">Index</a></p></blockquote></div></div><div class="collapse-0-0-4 "><script id="BpGLYbCfiT">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("BpGLYbCfiT", "yAdNJkOJGbj52dvfV+HpdQ==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><div class="label" onclick="this.parentElement.classList.toggle('open')"><span class="text">Veeam</span><span class="icon-font closed">chevron_right</span></div><div class="content"><blockquote><p><a href="/codedoc/docs/Knowledge/Veeam/Best%20Practices/index">Best Practices</a></p></blockquote></div></div><p><a href="/codedoc/docs/cheat-sheet">Markdown Cheat Sheet</a>
<a href="/codedoc/docs/code-features">Code Features</a></p><p><br><br></p><p>To add links to your other documents, simply
modify contents of <code>docs/md/_toc.md</code>.</p></div><div class="search-0-0-10"><script id="fylokppZks">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("fylokppZks", "EKtVWhWp+AfK3O64A4+bOg==", {"repo":"codedoc","user":"In-Pro-Org","root":"docs/md","pick":"\\.md$","drop":"(^_)|(\\/_)"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></div></div><div class="footer-0-0-7"><div class="left"><script id="dwrnRvKapw">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("dwrnRvKapw", "wCsMx1XMyC4jNi3FxvjU4g==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></div><div class="main"><div class="inside"><a href="https://github.com/In-Pro-Org/codedoc/" target="_blank">GitHub</a></div></div><div class="right"><script id="pQeCkYPJzT">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("pQeCkYPJzT", "6W59GcSTLBVXRr/Nl/rTkw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></div></div><script id="NfFoFrmfql">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("NfFoFrmfql", "zKXJ5zf13oJGCwAAI3JIIA==", {"namespace":"/codedoc"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></body></html>